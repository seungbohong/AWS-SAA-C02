# Database

### 

### 1.RDS

- AWS에 database 구축 : EC2에 DB를 설치하거나(unmanaged), AWS의 RDS를 이용하거나(managed)

- AWS RDS의 제약사항 : 버전이 제한적이다, Capacity에 상한선이 있다. OS에 로그인 불가능, 파일시스템에 로그인 불가능, IP 주소 고정 불가, 일부기능을 사용할 수 없다, 개별배치는 적용 불가능

- AWS RDS의 특징 : 매니지드형이라 고가용성이고 멀티 AZ에 master/slave구성을 간단히 구축할 수 있다.(동기식 레플리카, 장애조치 가능)

  참조전용 레플리카(비동기식)을 최대 5대(Aurora는 15대)설치 가능하며 RD의 읽기처리를 스케일 아웃 할수있다.

  자동으로 스냅샷 보존관리 할 수 있어서 장애내구성이 높다.(보관은 S3에 된다.)

  DB instance의 encryption

  보관시 인스턴스와 스냅샷에 대해 암호화가 가능하다.

  Encryption 대상 : DB instance, auto back-up, read replica, snapshot

  암호방식 : AES-256, AWS KMS에 의한 키관리, read replica도 같은 키를 사용, 인스턴스 작성시에만 설정가능, 스냅샷 카피에도 암호화, 복구 가능



### 2. Scailing

- DB의 퍼포먼스 저하 : 읽기처리가 늦다, 쓰기가 중단된다 등등

- 직렬 스케일링 : 메모리나 CPU를 변경(Scale up/Scale down)

- 병렬 스케일링 : 처리하는 기기나 서버수를 변경(스케일아웃/스케일인)

- Scale up : 인스턴스 사이즈를 변경/ 인스턴스 타입을 변경/스토리지 타입을 변경

- Scale out : Read replica를 증설/ Cache 이용/ Aurora에 이행

  (==시험에서는 scale out에 관한 내용이 자주 출제됨==)



### 3. ==Scale out==

- Read replica의 증설:

  최대 5대(Aurora는 15대) 설치 가능

  멀티 AZ나 크로스 리전에도 병용가능

  인스턴스나 스토리지 타입이 달라도 설정가능

  장애대응 등에서 read replica에서 stand alone DB instance에 수동으로 전환가능 (Aurora 제외)

  Aurora의 경우엔 프라이머리 인스턴스로 변경 가능

- 캐쉬의 이용 : 읽기처리의 일부를 캐쉬로 보존하여 고속 쿼리처리를 실현, ElastiCache이용, MySQL의 옵션기능 이용

  ElastiCache(쿼리를 캐쉬에 보존해놓고, 캐쉬에 있는 쿼리면 캐쉬에서 없는 쿼리면 DB에서 쿼리를 실행함)

  MySQL의 Option기능(Memcached를 이용하여 in-memory 캐쉬기능을 이용한다)

- 엄밀히 말하면 Scale out은 아니지만 Aurora에 이행하면 퍼포먼스 향상을 꾀할 수 있다.



### 4. DynamoDB

- 완전한 managed형인 NoSQL 데이터베이스 서비스

- 기능확장에 용이함, 저지연성(low-delay), high-availability(data stores in 3 AZs), managed

- Provisioned throughput : table당 read(100)와 write(1000)에 필요한 쓰루풋 캐퍼시티를 할당하고 있다.

- Storage의 용량 제한이 없음 : 데이터용량 증가에 대한 디스크나 노드 증설이 필요 없다.

- 사용 예)

  빅데이터(대용량 데이터의 수집, 축적, 분산을 위한 데이터베이스로 활용, Hadoop과 연계하여 빅데이터 처리가 가능)

  어플리케이션(대규모 서비스에서의 데이터 고속처리가 필요한 어플리케이션에 활용, 여러명의 유저가 한번에 엑세스 하는 어플리케이션에 대한 데이터 처리 등)

  유저행동 데이터 관리(유저정도, 게임, 광고등의 유저 행동 데이터용 DB, 유저 ID당 여러개의 행동이력관리등)

  백엔드 데이터처리(모바일 어플의 백엔드/배치 처리의 락관리/ 플래쉬 마케팅/ 스토리지의 인덱스등)



### 5. DynamoDB Stream

- DynamoDB테이블에 보존된 항목의 추가, 변경, 삭제 발생지의 이력을 캡쳐하는 기능

- 데이터보존(과거 24시간 이내의 데이터변경이력을 저장하여 24시간을 경과하면 삭제됨, 데이터 요량은 매니지드 형으로 자동적으로 관리된다.)

- 데이터 저장순서(조작이 실시된 순서로 데이터는 시리얼라이징된다/특정 해쉬키에 입각한 변경은 정확한 순서로 저장되지만, 해쉬키가 다를경우 수신한 순번이 바뀔 가능성도 있다.)

- 사용 예

  : 크로스리젼 레플리케이션(스트림에 의한 캡션을 트리거로 하여 크로스 리젼 레플리케이션을 실시할 수 있다.)

  데이터 갱신을 트리거로한 어플리케이션 기능(DynamoDBd의 입력을 트리거로 하여 Lambda함수에 의해 여러가지 처리를 자동화 하는 등)

  

### 6. DynamoDB Accelerator(DAX)

- DynamoDB에 in-memory cache형 기능을 추가함
- in-memory cache로써 1대의 밀리초단위에서 마이크로초단위까지 정합성이 높은 워크로드 응답시간을 단축. 멀티 AZ DAX 클러스터는 1초에 수백만건의 리퀘스트를 처리할 수 있다.
- 읽기처리가 많은 워크로드나 급속히 증가하는 워크로드에 대해 DAX는 throughput을 강화하거나 읽기 캐퍼시티 유닛을 필요이상으로 프로비져닝하지 않도록 설계함으로써 운용비용을 절약할 수 있다.



### 7. Global Table

- region간 동기되는 멀티 마스터 테이블 작성 가능
- DynamoDB의 성능을 유지하면서 세계에 있는 다수의 리젼에 앤드포인트를 설치할 수 있다.
- 읽기 캐퍼시티에 더해 크로스 리젼 어플리케이션의 데이터 전송요금이 부과된다..
- 정합성 설정은 불가능

### 

### 8. On-demand backup

- 퍼포먼스에 관계없이 수백TB의 백업도 실행 간으



### 9. Read/Write Capacity On-demand

- capacity 설정 필요없이 리퀘스트에 따른 요금설정이 가능하게 됨(트래픽양에 예측이 어려울경우에 사용, 프로비젼드 캐퍼시티 설정에 변경은 무제한으로 할 수 있다. 하지만 온디맨드의 변경은 하루 한번만 가능하다.)

  

### 10. ==Aurora==

- distributed RD/ NoSQL의 분산처리 속도와 RDB의 데이터 조작성을 양립
- 병렬처리기능이 좋아 대량 읽기쓰기를 하는데 적합
- MySQL/PostgreSQL과 호환성을 가짐
- 과거에 데이터를 S3에 계속해서 백업함.
- 1개의 인스턴스와 1개의 DB cluster volume으로 구성되며 3개의 AZ에 복제됨
- 마스터와 read replica(최대 15개)로 하나의 DB cluster를 구성한다. 접속은 엔드포인트를 통해 한다. Write는 마스터로 reader은 replica로 나눠서 처리할 수 있다.
- 멀티 마스터를 구성하면 write처리도 유연하게 구축가능하다.
- 사용 예 : 대규모 쿼리가 발생하는 RDB환경, 쿼리의 병렬처리가 많음, 데이터가 큼, 테이블이 많음 등, 트랜잭션 발생량 많음 등.



### 11. Aurora Global DB

- 타 리전에 대한 고성능 리드 레플리카 작성 가능
- 로그 전송이 아닌 스토리지 레벨의 레플리케이션